*原文：https://www.iab.com/wp-content/uploads/2016/03/OpenRTB-API-Specification-Version-2-5-FINAL.pdf*

<!--
bid: 入札
buyer: 買い手
exchange: 取引所
inventory: 在庫
publisher: 配信者
seller: 売り手
-->

## 1. イントロダクション

### 1.1 ミッションと概要

OpenRTBプロジェクトの使命は、広告主である買い手と配信在庫を抱える売り手との間のコミュニケーションのためのオープンな業界標準を提供することで、リアルタイムビディング（RTB）市場における成長を促進することです。
提供される標準には、実際のリアルタイム入札プロトコル、情報分類、オフライン構成同期といったいくつかの側面がありますが、これらに限定されるわけではありません。

<!-- The mission of the OpenRTB project is to spur growth in Real-Time Bidding (RTB) marketplaces by providing open industry standards for communication between buyers of advertising and sellers of publisher inventory.  There are several aspects to these standards including but not limited to the actual real-time bidding protocol, information taxonomies, offline configuration synchronization, and many more. -->

このドキュメントでは、以前の「ブロックリストプロジェクト」や「OpenRTB モバイル」プロジェクト (※1) といった OpenRTB コラボレーションから成長した、リアルタイムビディングインタフェイスの標準を規定しています。
これらのプロトコル標準は、配信在庫の供給主（つまり、取引所、配信者と連携しているネットワーク、売り手側のプラットフォーム）とその在庫の競争的な買い手（つまり、入札者、買い手側のプラットフォーム、もしくは広告主と連携しているネットワーク）との間の接続を簡素化することを目的としています。

<!-- This document specifies a standard for the Real-Time Bidding Interface that has grown out of previous OpenRTB collaboration on the “blocklist project” and the “OpenRTB Mobile” project. These protocol standards aim to simplify the connection between suppliers of publisher inventory (i.e., exchanges, networks working with publishers, and sell-side platforms) and competitive buyers of that inventory (i.e., bidders, demand side platforms, or networks working with advertisers) -->

OpenRTB の包括的な目標は、買い手と売り手の間のコミュニケーションのためのリンガフランカ (※2) を作成することでした。 その目的は、各事業の運営方法を正確に規制することではありません。 プロジェクトとして当事者間の統合を容易にすることを目指し、エコシステム内の各事業においてより深いレベルでのイノベーションが起こることを目的としています。

<!-- The overall goal of OpenRTB is and has been to create a lingua franca for communicating between buyers and sellers. The intent is not to regulate exactly how each business operates. As a project, we aim to make integration between parties easier, so that innovation can happen at a deeper-level at each of the businesses in the ecosystem. -->

※1 訳注：「OpenRTB Blocklist API」と「OpenRTB Mobile」を指しているものと思われる。
※2 訳注：共通の母語を持たない集団内において意思疎通に使われている言語のこと。

### 1.2 OpenRTB の歴史

OpenRTBは、2010年11月に3つの買い手側プラットフォーム（DataXu、MediaMath、Turn）と3つの売り手側プラットフォーム（Admeld、PubMatic、The Rubicon Project）のパイロットプロジェクトとして立ち上げられました。最初の目標は、ブロックリストを交換する当事者間の通信を標準化することでした。OpenRTB ブロックリスト仕様のバージョン 1.0 は 2010年12月にリリースされました。

<!-- OpenRTB was launched as a pilot project between three demand-side platforms (DataXu, MediaMath, and Turn) and three sell-side platforms (Admeld, PubMatic, and The Rubicon Project) in November 2010.  The first goal was to standardize communication between parties for exchanging block lists. Version 1.0 of the OpenRTB block list specification was released in December 2010. -->

業界からの肯定的な回答の後、Nexage は実際のリアルタイム入札要求・応答プロトコルに焦点を当てた、特にモバイル広告をサポートする OpenRTB 用の API 仕様を作成するという提案を OpenRTB プロジェクトに持ち込みました。モバイル小委員会は、買い手側（DataXu、Fiksu、[X + 1]）と売り手側（Nexage、Pubmatic、Smaato、Jumptap）を代表する企業同士で結成されました。 このプロジェクトは、2011年2月にリリースされた OpenRTB モバイル 1.0 仕様をもたらしました。

<!-- After a positive response from the industry, Nexage approached the OpenRTB project with a proposal to create an API specification for OpenRTB focusing on the actual real-time bid request/response protocol and specifically to support mobile advertising.  The mobile subcommittee was formed between companies representing the buy-side (DataXu, Fiksu, and [X+1]) and companies representing the sell-side (Nexage, Pubmatic, Smaato, and Jumptap).  This project resulted in the OpenRTB Mobile 1.0 specification, which was released in February 2011. -->

モバイル仕様のリリースに続いて、DataXu と ContextWeb が協力して動画のサポートを組み込んだ動画広告取引所（BrightRollとAdap.tv）に合わせてビデオ小委員会が結成されました。 その目標は、ディスプレイ、動画、モバイルのサポートを一つに統合することでした。 この取り組みによりOpenRTB 2.0 が生まれ、これが2011年6月に統一規格としてリリースされました。

OpenRTB は業界で非常に幅広く採用されているため、2012年1月にバージョン 2.1 のリリースに併せて IAB 標準として採用されました。仕様の技術的な内容に関するガバナンスは、OpenRTB コミュニティとそのガバナンスルールにとどまります。

### 1.3 バージョン

#### OpenRTB リアルタイムビディング API

* 2.5 ヘッダビディング、請求および敗北通知、フレックス広告、ペイメントID、タクティック ID、インプレッションメトリクス、アウトストリームビデオ、その他多くの軽微な機能拡張をサポート。
* 2.4 オーディオ広告帯のサポートと、v2.x の歴史の中で最も大規模な軽度から中程度の機能拡張。
* 2.3 ネイティブ広告帯と複数の軽微な機能拡張のサポート。
* 2.2 非公開市場直接取引、ビデオ、モバイル、および規制信号に関する新しい機能拡張。
* 2.1 IQGコンプライアンス、軽微な機能拡張、および訂正のための改訂。
* 2.0 ディスプレイ、モバイル、ビデオの標準を統一仕様へ統合。
* 1.0 OpenRTB モバイルの元リリース。

#### OpenRTB ディスプレイブロックリストブランチ

* 1.2 配信者設定 API (提案済み)。
* 1.1 クリエイティブ属性のリアルタイムエクスチェンジを含める軽微な変更。
* 1.0 OpenRTB ブロックリスト仕様の元リリース。

### 1.4 リソース

* OpenRTB GitHub リポジトリ - [github.com/openrtb/OpenRTB/](http://github.com/openrtb/OpenRTB)
* 開発コミュニティメーリングリスト - [groups.google.com/group](http://groups.google.com/group/openrtb-dev)
* ユーザコミュニティメーリングリスト - [groups.google.com/group/openrtb-user](http://groups.google.com/group/openrtb-user)

### 1.5 用語

以下の用語は、特に OpenRTB インタフェースとこの仕様の文脈において本書において使用されています。

| 用語 | 定義 |
| - | - |
| RTB | リアルタイム（つまり、顧客が待機している間）での個々のインプレッションの入札。 |
| 取引所 | 入札者の間でインプレッション単位のオークションを行うサービス。 |
| 入札者 | インプレッションを獲得するためにリアルタイムオークションにおいて競争する主体。 |
| シート | インプレッションの取得を目的とする、入札者を代理して広告活動を行う主体（たとえば、広告主、代理店）。 入札者の顧客で、通常は広告予算の所有者。 |
| 配信者 | 単一もしくは複数のサイトを運営する主体。 |
| サイト | 特に指定がなければウェブとアプリケーションを含む広告サポートコンテンツ。 |
| 取引 | 特定の条件の下でインプレッションを購入することについての配信者とシートの間の事前協定。 |

## 2. OpenRTB の基礎

次の図は、取引所とその入札者の間の OpenRTB のやりとりを示しています。広告リクエストは配信者のサイトまたはアプリケーションから始まります。 入ってきた広告リクエストに対して、入札リクエストが入札者にばらまかれ、レスポンスが一般的なオークションルールの下で算出され、勝者が絞られます。落札者は勝利通知を介してオークションの勝利を通知されます。 広告マークアップは、落札を見越して入札に含まれることもありますし、勝利通知のレスポンスに含まれることもあります。 また、OpenRTB 仕様の範囲外の取引所によって制定された様々なポリシー（例えば、デバイス配信、閲覧可能性などの請求）に適応するため、別途請求通知を利用することもできます。 勝利通知は入札者の価格決定アルゴリズムの成功を通知し、請求通知は実際に費用が費やされるかを示します。 入札者にその入札が勝利しなかった理由を通知するために敗北通知を利用することもできます。

勝利、請求および敗北通知の URL、または広告マークアップそれ自体に、取引所が入札者に重要なデータを伝えることを可能にするいくつかの標準的なマクロを含むことができます（例えば、清算価格）。

図 2:  参照モデル - リクエストシーケンス。

この仕様では、入札リクエストとレスポンス、勝利、請求、および敗北通知のリアルタイムなやりとりに焦点を当てています。 他のやりとり（例えば、ブロックリスト同期、トラフィック制御、クリエイティブレビューなど）は、将来の OpenRTB の第一歩もしくは代替プロジェクトの候補になります。

### 2.1 通信

取引所とその入札者間の基本プロトコルは HTTP です。 具体的には、HTTP POSTは入札リクエストにおいて HTTP GET よりも大きなペイロードに対応するためと、バイナリ表現の使用を容易にするために必要とされます。勝利通知は、取引所の裁量で POST もしくは GET のいずれかになるでしょう。

内容を返す呼び出し（例えば、任意の入札レスポンス、マークアップを返す勝利通知）には HTTP コード 200 を返すべきです。妥当なリクエストに対して内容を返さない呼び出し（例えば、入札無しを示す一つの方法である空の入札レスポンス、マークアップを返さない勝利通知）には HTTP 204 を返すべきです。無効な呼び出し（例えば、不正なまたは壊れたペイロードを含む入札リクエスト）には内容無しで HTTP 400 を返すべきです。

ベストプラクティス：
接続パフォーマンスを向上させる最も簡単で効果的な方法は、キープアライブとして知られる HTTP 永続接続を有効にすることです。 これは、通信端末双方において接続管理負荷だけでなく CPU 使用率も削減されるため、全体的なパフォーマンスに大きく影響します。

### 2.2 セキュリティ

OpenRTB 準拠のために HTTPS（セキュアHTTP）は必要ありません。しかし、業界では取引所・入札者間通信のセキュリティを強化するために HTTPS を使用する傾向が高まっています。したがって、取引所と入札者は HTTP と HTTPS の両方のサポートを検討することが推奨されます。

### 2.3 データ形式

JSON（JavaScript Object Notation）は、入札リクエストと入札レスポンスのデータペイロードのための推奨フォーマットです。 JSONは、人間の読みやすさとコンパクトさを組み合わせたものです。 データペイロードについては、3章と4章で説明します。

取引所は任意でバイナリ形式（例えば、圧縮 JSON、ProtoBuf、Avro など）を提供しても良く、送信時間および帯域幅の点でより効率的になることがあります。IAB テックラボは、これらのフォーマットまたは他のフォーマットのリファレンス実装を提供することがあります。 可能であれば、取引所固有の差異を減らすために、これらの IAB リファレンス実装の使用を強く推奨します。
入札リクエストでは Content-Type HTTP ヘッダを使用し、MIME タイプとしてその形式を指定します。標準的な JSON 形式の MIME タイプは "application / json" です。入札レスポンスの形式は、入札リクエストと同じである必要があります。

```
Content-Type: application/json
```

標準とは別のバイナリ形式が使用されている場合、取引所または SSP は Content-Type を適切に指定すべきです。例えば "Content-Type: avro/binary" もしくは "Content-Type: application/x-protobuf" とします。 Content-Type が見つからない場合は、取引所によって別のデフォルト形式が選択されていないかぎり、入札者は application/json であると仮定すべきです。

慣例的に、属性が存在しないということには正式な意味があります。 多くの場合、特に指定しない限りこれは値が不明であることを示します。

### 2.4 データエンコーディング

取引所と入札者間で送られるデータを圧縮することは非常に有益です。圧縮により転送されるデータのサイズが大幅に縮小され、取引所および入札者の双方でネットワーク帯域幅が節約されます。 この節約を完全に実現するために、取引所から送られる入札リクエストと入札者から返される入札レスポンスの双方に対して、圧縮を有効にすべきです。

標準的な HTTP 1.1 機構を用いて、入札レスポンスにおいて圧縮を有効にすることができます。多くの Web サーバは既にレスポンス情報の gzip 圧縮をサポートしていて理想的な選択です。取引所が圧縮されたレスポンスを欲していることを伝えるには、HTTP 1.1 Accept-Encoding ヘッダを設定すべきです。エンコーディング値は "gzip" が用いられるべきです。

```
Accept-Encoding: gzip
```

このヘッダはレスポンスの gzip エンコーディングを受け入れることができるという取引所による指示を入札者に提示します。入札者サーバがこれをサポートし正しく構成されていれば、gzip でエンコードされたデータで自動的に応答します。 これは HTTP 1.1 Content-Encoding ヘッダを用いて示されます。

```
Content-Encoding: gzip
```

入札リクエストに対して圧縮を有効にするには、まず取引所と入札者間でこれをサポートされていることが合意されなければならない。
取引所が入札リクエストを送信する前に形式とエンコーディングの両方を知っていなければならないので、カスタムデータ形式が用いられる場合と似ています。
入札者がサポートしている場合、取引所は HTTP 1.1 Content-Encoding ヘッダを設定して gzip 圧縮した入札リクエストを送信していることを示すべきです。
用いられるエンコーディング値は "gzip" であるべきです。

```
Content-Encoding: gzip
```

このヘッダが設定されていない場合、リクエスト情報はエンコードされていないものとみなされます。HTTP 1.1 では、通常 Content-Encoding ヘッダはレスポンス情報にのみに用いられます。 しかしこのヘッダをリクエスト情報に用いることで、用いられるデータ形式に関係なくリクエストが圧縮されていることを示すことができます。 これはバイナリデータ形式であっても圧縮されることで恩恵を受けることができて便利です。

### 2.5 OpenRTB バージョン HTTP ヘッダ

OpenRTB バージョンは、入札リクエストのヘッダでカスタムヘッダパラメータを用いて渡されるべきです。 これによって入札者はリクエストを解析しようとする前に含まれるメッセージのバージョンを認識することができます。 さらに、入札者が実装したプロトコルのバージョンをレスポンスの HTTP ヘッダに含めて同じ形式のメッセージにすることは任意ではあるものの推奨されます。 メッセージにはリクエストヘッダとは異なるバージョン番号が含まれていても構いません。

```
x-openrtb-version: 2.5
```

バージョンは <メジャー>.<マイナー>（例えば 2.5）のように指定されるべきです。第1レベルもしくは第2レベルのバージョンが増えることはプロトコルの変更です。 一般に、第2レベルの変更は下位互換性があるべきですが、第1レベルの変更は下位互換性がある必要はありません。第3レベルの更新（2.5.1 のような）ではプロトコル自体を変更すべきではなく、プロトコルの内容に影響を及ぼさない説明と注記のみの変更にすべきです。 第3レベルのバージョンは技術的な影響がないはずなのでこのヘッダーに含めるべきではありません。

### 2.6 設計に基づくプライバシー

OpenRTB プロジェクトは、広告の買い手および売り手によって指定されたプライバシーポリシーを完全にサポートしています。 特に OpenRTB は do-not-track（3.2.18 節）、COPPA 制限シグナリング（7.5 節）、User オブジェクトを通して売り手から買い手へユーザ設定を渡す機能（3.2.20 節）をサポートしています。

### 2.7 在庫品質ガイドラインとの関係

OpenRTB は www.tagtoday.net/iqg から手に入れられる在庫品質ガイドライン（IQG）と完全に互換性があります。特にこの仕様で用いられる分類と羅列の多くは、IQG および IAB テックラボから派生しています。

### 2.8 カスタマイズと拡張

OpenRTB 仕様では、取引所固有のカスタマイズや拡張を許容しています。あらゆるオブジェクトが拡張を含んでいて構いません。拡張フィールドのプラットフォーム間での一貫性を保つために、ext という名前を一貫して付けるべきです。

## 3. 入札リクエスト仕様

RTB トランザクションは、取引所または他の配信元が入札リクエストを入札者に送信すると開始されます。
入札リクエストは、最上位の入札リクエストオブジェクトと、少なくとも1つのインプレッションオブジェクトで構成され、さらにインプレッションの属性を提供する追加のオブジェクトを任意で含めることができます。

### 3.1 オブジェクトモデル

次の図は入札リクエストのオブジェクトモデルです。 モデル内の最上位オブジェクト（つまり、JSON の無名外部オブジェクト）は BidRequest として表されます。
直下のオブジェクトの中で、売られたインプレッションを表す基礎になる Imp のみが必須であり、Imp はインプレッションの型を定義するために Banner （複数の形式を許可しても構いません）、Video、Audio、Native の少なくとも一つを必須とします。でインプレッションのタイプを定義する必要があるため 出版社が受諾しようとしているもののうちの1つ以上を指定するものとします。 インプレッションは任意で非公開市場を対象とすることができます。

図3:  入札リクエストオブジェクトモデル

### 3.2 オブジェクト仕様

#### 3.2.1 オブジェクト：BidRequest

#### 3.2.2 オブジェクト：Source

#### 3.2.3 オブジェクト：Regs

#### 3.2.4 オブジェクト：Imp

#### 3.2.5 オブジェクト：Metric

#### 3.2.6 オブジェクト：Banner

#### 3.2.7 オブジェクト：Video

#### 3.2.8 オブジェクト：Audio

#### 3.2.9 オブジェクト：Native

#### 3.2.10 オブジェクト：Format

#### 3.2.11 オブジェクト：Pmp

#### 3.2.12 オブジェクト：Deal

#### 3.2.13 オブジェクト：Site

#### 3.2.14 オブジェクト：App

#### 3.2.15 オブジェクト：Publisher

#### 3.2.16 オブジェクト：Content

#### 3.2.17 オブジェクト：Producer

#### 3.2.18 オブジェクト：Device

#### 3.2.19 オブジェクト：Geo

#### 3.2.20 オブジェクト：User

#### 3.2.21 オブジェクト：Data

#### 3.2.22 オブジェクト：Segment

## 4. 入札レスポンス仕様

## 5. 列挙リスト仕様

## 6. 入札リクエスト・レスポンス見本

## 7. 実装の注意

### 7.1 無入札の発信

### 7.2 インプレッションの失効

### 7.3 PMP & 直接取引

### 7.4 スキップの可否

### 7.5 COPPA 規則フラグ

## 付録A. 追加情報

## 付録B. 仕様変更履歴
